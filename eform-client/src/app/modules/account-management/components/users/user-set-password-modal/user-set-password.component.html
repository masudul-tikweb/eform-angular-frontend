<h3 mat-dialog-title>{{ 'Set user password' | translate }}</h3>
<div mat-dialog-content>
  <div class="d-flex flex-row justify-content-between">
    <div class="d-flex flex-column">
      <p>ID</p>
    </div>
    <div class="d-flex flex-column">
      <strong>{{ selectedUser.id }}</strong>
    </div>
  </div>
  <div class="d-flex flex-row justify-content-between">
    <div class="d-flex flex-column">
      <p>{{ 'Email' | translate }}</p>
    </div>
    <div class="d-flex flex-column">
      <strong>{{ selectedUser.email }}</strong>
    </div>
  </div>
  <form [formGroup]="setPasswordForm">
    <mat-form-field>
      <mat-label>{{ 'New password' | translate }}</mat-label>
      <input
        matInput
        [type]="newPasswordVisible ? 'text' : 'password'"
        name="newPassword"
        formControlName="newPassword"
        required
        id="newPassword"
        autocomplete="new-password"
      />
      <mat-icon
        matSuffix
        (click)="toggleNewPasswordVisibility()"
        style="cursor: pointer;"
        [attr.aria-label]="'Toggle password visibility'"
      >
        {{ newPasswordVisible ? 'visibility_off' : 'visibility' }}
      </mat-icon>
      <mat-error *ngIf="setPasswordForm.get('newPassword')?.hasError('required')">
        {{ 'Password is required' | translate }}
      </mat-error>
      <mat-error *ngIf="setPasswordForm.get('newPassword')?.hasError('minlength')">
        {{ 'Password must be at least 8 characters' | translate }}
      </mat-error>
      <mat-error *ngIf="setPasswordForm.get('newPassword')?.hasError('weakPassword')">
        {{ 'Password is too weak' | translate }}
      </mat-error>
    </mat-form-field>

    <!-- Password Strength Meter -->
    <mat-password-strength
      [password]="setPasswordForm.get('newPassword')?.value || ''"
      [enableLengthRule]="true"
      [enableLowerCaseLetterRule]="true"
      [enableUpperCaseLetterRule]="true"
      [enableDigitRule]="true"
      [enableSpecialCharRule]="false"
      [min]="8"
      [max]="50"
      (onStrengthChanged)="onPasswordStrengthChanged($event)">
    </mat-password-strength>

    <mat-form-field>
      <mat-label>{{ 'New password confirmation' | translate }}</mat-label>
      <input
        matInput
        [type]="confirmPasswordVisible ? 'text' : 'password'"
        formControlName="confirmPassword"
        required
        id="newPasswordConfirmation"
        name="newPasswordConfirmation"
        autocomplete="new-password"
      />
      <mat-icon
        matSuffix
        (click)="toggleConfirmPasswordVisibility()"
        style="cursor: pointer;"
        [attr.aria-label]="'Toggle password visibility'"
      >
        {{ confirmPasswordVisible ? 'visibility_off' : 'visibility' }}
      </mat-icon>
      <mat-error *ngIf="setPasswordForm.get('confirmPassword')?.hasError('required')">
        {{ 'Password confirmation is required' | translate }}
      </mat-error>
      <mat-error *ngIf="setPasswordForm.get('confirmPassword')?.hasError('mismatch')">
        {{ 'Passwords do not match' | translate }}
      </mat-error>
    </mat-form-field>
  </form>
</div>
<div mat-dialog-actions class="d-flex flex-row justify-content-end">
  <button
    mat-raised-button
    color="warn"
    id="userDeleteBtn"
    (click)="setPassword()"
    [disabled]="setPasswordForm.invalid"
  >
    {{ 'Save' | translate }}
  </button>
  <button
    mat-raised-button
    id="userDeleteCancelBtn"
    (click)="hide()"
  >
    {{ 'Cancel' | translate }}
  </button>
</div>
